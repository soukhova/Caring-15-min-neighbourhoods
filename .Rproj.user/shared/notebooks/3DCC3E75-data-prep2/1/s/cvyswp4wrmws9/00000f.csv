"0","sp_avail_detailed <- function(x, o_id, d_id, pop, opp, r, f, alpha = 1){"
"0","  "
"0","  o_id <- rlang::enquo(o_id)"
"0","  d_id <- rlang::enquo(d_id)"
"0","  pop <- rlang::enquo(pop)"
"0","  opp <- rlang::enquo(opp)"
"0","  r <- rlang::enquo(r)"
"0","  f <- rlang::enquo(f)"
"0","  "
"0","  sum_pop <- x |>"
"0","    dplyr::distinct(!!o_id,"
"0","                    .keep_all = TRUE) |>"
"0","    dplyr::mutate(sum_pop = !!r*(!!pop)^alpha) |>"
"0","    dplyr::pull(sum_pop) |>"
"0","    sum()"
"0","  "
"0","  f_p <- dplyr::pull(x, !!r) * dplyr::pull(x, !!pop)^alpha / sum_pop"
"0","  "
"0","  sum_impedance <- x |>"
"0","    dplyr::group_by(!!d_id) |>"
"0","    dplyr::summarize(sum_impedance = sum(!!f))"
"0","  "
"0","  x <- x |>"
"0","    dplyr::left_join(sum_impedance,"
"0","                     by = rlang::as_name(d_id))"
"0","  "
"0","  f_c <- dplyr::pull(x, !!f) / x$sum_impedance"
"0","  "
"0","  x$f_c <- f_c"
"0","  x$f_p <- f_p"
"0","  "
"0","  sum_pa <- x |>"
"0","    dplyr::group_by(!!d_id) |>"
"0","    dplyr::summarize(sum_pa= sum(f_p * f_c))"
"0","  "
"0","  x <- x |>"
"0","    dplyr::left_join(sum_pa,"
"0","                     by = rlang::as_name(d_id))"
"0","  x$f_t <- (f_p * f_c) / dplyr::pull(x, sum_pa)"
"0","  "
"0","  x |>"
"0","    dplyr::mutate(V_ij = !!opp * f_t)"
"0","}"
